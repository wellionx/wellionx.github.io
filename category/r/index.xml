<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>R | Wei Li|李伟</title>
    <link>/category/r/</link>
      <atom:link href="/category/r/index.xml" rel="self" type="application/rss+xml" />
    <description>R</description>
    <generator>Wowchemy (https://wowchemy.com)</generator><language>en-us</language><copyright>Wei Li ©2024 </copyright><lastBuildDate>Thu, 09 Sep 2021 00:00:00 +0000</lastBuildDate>
    <image>
      <url>/images/icon_hu1ced7b333353f5a008e2ad419da4d284_46376_512x512_fill_lanczos_center_2.png</url>
      <title>R</title>
      <link>/category/r/</link>
    </image>
    
    <item>
      <title>The key steps of protein content visualizaiton through HSI</title>
      <link>/post/the-key-steps-of-protein-content-visualizaiton-through-hsi/</link>
      <pubDate>Thu, 09 Sep 2021 00:00:00 +0000</pubDate>
      <guid>/post/the-key-steps-of-protein-content-visualizaiton-through-hsi/</guid>
      <description>&lt;p&gt;如上图所示，通过成像光谱，我们可以很轻松的对小麦籽粒中的蛋白含量进行可视化。&lt;/p&gt;
&lt;h4 id=&#34;籽粒蛋白成像的基本步骤&#34;&gt;籽粒蛋白成像的基本步骤&lt;/h4&gt;
&lt;p&gt;这一过程的实现，包含两个关键步骤：一是建立单籽粒水平的光谱预测模型；二是将模型应用的图像中，使用图像处理的方法进行可视化。&lt;/p&gt;
&lt;p&gt;光谱建模的步骤是常规操作，这里不再赘述。&lt;/p&gt;
&lt;h4 id=&#34;光谱图像可视化籽粒蛋白含量&#34;&gt;光谱图像可视化籽粒蛋白含量&lt;/h4&gt;
&lt;p&gt;本文重点讲一下图像处理的过程。&lt;/p&gt;
&lt;p&gt;我们都知道光谱图像（HSI）具有光谱和图像的双重特征。也就是说在光谱图像中，每一个像素都包含了一条光谱信息。而根据像素的光谱信息，再利用建立的籽粒蛋白预测模型，我们可以很容易的预测图像中每一个像素的蛋白含量。下图便是我们得到的一张像素水平的籽粒蛋白含量图。
&lt;img src=&#34;pixel_level_GPC.jpg&#34; alt=&#34;像素蛋白成像&#34;&gt;&lt;/p&gt;
&lt;p&gt;这个图展示了两个蛋白含量不同的品种。图中虽然能大体看出两个品种的差异，然而具体到每个品种中各不同籽粒的差异，就无法分辨了。&lt;/p&gt;
&lt;p&gt;造成这样结果的原因是，图像中单个籽粒内部不同像素的光谱其实是存在较大差异的。而由于受到拍摄环境和像素位置等的影响，这些光谱的差异是不可避免的。当用这些有差异的光谱进行蛋白预测时，必然会导致籽粒内部像素级蛋白的巨大差异。为了处理这些差异，或者缩小这些差异，我们采用均值模糊的方法对图像进行处理。具体处理方法是，用临近的6个像素的平均值代表该像素，这样就能在一定程度上缩小误差。经过模糊均值处理的图像如下图所示。
&lt;img src=&#34;blur_pr_img.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;单籽粒籽粒蛋白含量可视化&#34;&gt;单籽粒籽粒蛋白含量可视化&lt;/h4&gt;
&lt;p&gt;在育种过程中，对单籽粒的选择尤为重要。虽然室内的近红外光谱可以一定程度上实现单籽粒蛋白的测定，但是其效率不高。而成像光谱为单籽粒蛋白含量的测定提供了很好的工具。&lt;/p&gt;
&lt;p&gt;本研究得到的图像，经过图像分割处理，可以将图像中的籽粒区分开来。结合建立的模型，对每一个独立籽粒的蛋白含量就行预测，即可得到单籽粒蛋白含量图像。&lt;/p&gt;
&lt;p&gt;从图像中可以看出，大部分籽粒都与其他籽粒相互分开分开。籽粒之间的分割，首先采用了连通区域分析算法，这个算法将相互连接的像素区域打上相同的标记。根据标记可以区分出不同的分离物体（籽粒）。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;labeltheseedmix.gif&#34; alt=&#34;&#34; title=&#34;连通区域法分割籽粒&#34;&gt;
这个动图形象的展示了该图形分割方法。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;Figure_labeledseeds.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;然而我们发现，其中还有一些籽粒挨的比较近，无法分开。于是尝试用另外一种方法——分水岭算法进行分割。最终得到满意的分割图像，然后将每个籽粒内部对应的蛋白质（像素水平）预测含量取平均值，用颜色标签展示数值范围。就能得到最终想要的图像了。该图形可以交互展示，即鼠标放到对应的籽粒上，会在右上角显示该位置坐标和对应的籽粒蛋白含量。
&lt;img src=&#34;seedprpick.gif&#34; alt=&#34;&#34; title=&#34;单籽粒蛋白成像交互演示&#34;&gt;
下面图片展示了两个品种的单籽粒成像图。
由于通过图像分割对每个籽粒进行了标记，因此可以得到每一个籽粒的蛋白含量数据。利用这些数据可以做一些统计分析。
&lt;img src=&#34;single_seed_grain_protein_content_chn.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/post/the-key-steps-of-protein-content-visualizaiton-through-hsi/index_files/figure-html/unnamed-chunk-1-1.png&#34; width=&#34;768&#34; /&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>手把手教你安装R</title>
      <link>/post/get-your-hands-dirty-install-r-from-the-begining/</link>
      <pubDate>Thu, 15 Apr 2021 00:00:00 +0000</pubDate>
      <guid>/post/get-your-hands-dirty-install-r-from-the-begining/</guid>
      <description>&lt;p&gt;写在前面：在正式安装R之前需要做下准备工作，下载原生的R软件以及最好用的R操作界面Rstudio。&lt;/p&gt;
&lt;p&gt;链接地址：&lt;/p&gt;
&lt;p&gt;R &lt;a href=&#34;https://mirrors.tuna.tsinghua.edu.cn/CRAN/&#34;&gt;https://mirrors.tuna.tsinghua.edu.cn/CRAN/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Rstudio &lt;a href=&#34;https://www.rstudio.com/products/rstudio/download/#download&#34;&gt;https://www.rstudio.com/products/rstudio/download/#download&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;新手在安装R时常常会犯一些错误，导致后期在使用和升级R时体验极为不佳。我这个安装教程是总结了多次安装实战经验之后写下的，希望对想学R但又无从下手的同学能有所帮助。
另外，安装过程详细的避坑指南，可以参考谢益辉写的&lt;a href=&#34;https://bookdown.org/yihui/r-ninja/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;R语言忍者秘笈&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;下面进入正式的安装教程：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;安装原生R (R-4.0.5-win.exe)&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;安装时要注意一定一定一定要选择English版本&lt;/li&gt;
&lt;li&gt;安装目录去掉版本号(C:\Program Files\R)&lt;/li&gt;
&lt;li&gt;安装选项仅勾选Core files 和 64-bit files即可&lt;/li&gt;
&lt;li&gt;其他配置都按照默认即可&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;安装Rstudio (默认安装)&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;千万注意顺序，安装原生R之后，再Rstudio&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;打开并配置Rstudio，包括字体大小和package的镜像（亲测兰州大学镜像好用）&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;字体配置Tools/Global Options/Appearance&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Package镜像配置Tools/Global Options/Packages&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;用户目录的设置（参考R语言忍者秘籍），具体方式如下：&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-R&#34;&gt;normalizePath(&#39;~&#39;) # 查看用户目录
# 如果文件不存在，它会被自动创建
file.edit(&#39;~/.Renviron&#39;)
# 写入配置文件中，保存，重启R
R_LIBS_USER=&amp;quot;~/R/libs&amp;quot; # C盘C:\Users\Wei\Documents\R\libs
R_LIBS_USER=&amp;quot;D:/Rlibs&amp;quot; # 可以设置成自己喜欢的位置
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;之所以要单独设置一个lib path，是为了方便升级时迁移已经安装的R包。因为后期安装的R包都会优先存储到新配置的目录下。一方面更新R包的时候不需要重新安装，只需将Rlib目录下的R包文件拷贝出来即可；另一方面，附加R包与主程序包是分开的，极大的方便的包的管理。&lt;/p&gt;
&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;检测libPaths位置是否配置成功&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-R&#34;&gt;.libPaths()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;输入以上代码，如显示如下内容，表示配置成功。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;[1] &amp;ldquo;D:/Rlibs&amp;rdquo;    &amp;ldquo;C:/Program Files/R/library&amp;rdquo;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;如不成功，则需重启电脑后查看是否配置生效。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;推荐R图库，有相关的图和代码
&lt;a href=&#34;https://www.r-graph-gallery.com/index.html&#34;&gt;https://www.r-graph-gallery.com/index.html&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>R packages for Data Science</title>
      <link>/post/2020-12-18-r-packages-for-data-science/</link>
      <pubDate>Wed, 02 Dec 2020 00:00:00 +0000</pubDate>
      <guid>/post/2020-12-18-r-packages-for-data-science/</guid>
      <description>&lt;h3 id=&#34;r-包网站&#34;&gt;R 包网站&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;cowplot&lt;/code&gt;包，用于组合图形和图片&lt;/p&gt;
&lt;p&gt;链接在此：&lt;a href=&#34;https://wilkelab.org/cowplot/articles/introduction.html&#34;&gt;https://wilkelab.org/cowplot/articles/introduction.html&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;ggpubr&lt;/code&gt;包，号称可以生成发表级别的图。简单易用，但是灵活性不足。数据探索可以考虑使用&lt;/p&gt;
&lt;p&gt;链接在此：&lt;a href=&#34;https://rpkgs.datanovia.com/ggpubr/index.html&#34;&gt;https://rpkgs.datanovia.com/ggpubr/index.html&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;ggstatsplot&lt;/code&gt;包, 画出来的图既漂亮还带有统计参数。棒棒棒！！！
&lt;a href=&#34;https://indrajeetpatil.github.io/ggstatsplot/&#34;&gt;https://indrajeetpatil.github.io/ggstatsplot/&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;sf&lt;/code&gt;包, 画地图的包，兼容性好。做不规则多边形也很好。当年我用轮廓构建的小麦植株就是用这个包做成的。
&lt;a href=&#34;https://r-spatial.github.io/sf/index.html&#34;&gt;https://r-spatial.github.io/sf/index.html&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;ggcor&lt;/code&gt;包，做相关性分析比较强大的包，简化了很多分析的门槛，输出相关性的矩阵也很方便。然而由于某些原因，作者删除了包。&lt;/p&gt;
&lt;p&gt;备份版本可以在gitee上找到：&lt;a href=&#34;https://gitee.com/wellionx/ggcor&#34;&gt;https://gitee.com/wellionx/ggcor&lt;/a&gt;
可以通过devtools安装使用。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;devtools::install_git(&amp;quot;https://gitee.com/wellionx/ggcor.git&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;ggvis&lt;/code&gt;包，可以画出很漂亮图形的R包
&lt;a href=&#34;http://ggvis.rstudio.com/&#34;&gt;http://ggvis.rstudio.com/&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;endextend&lt;/code&gt;包，一个美化和拓展tree的包
&lt;a href=&#34;http://talgalili.github.io/dendextend/articles/dendextend.html&#34;&gt;http://talgalili.github.io/dendextend/articles/dendextend.html&lt;/a&gt;
做聚类分析，用于可视化的包，fviz_dend()函数在展示大型树的时候，加载过于漫长。于是搜索有没有更好的解决方法。终于找到了&lt;code&gt;dendextend&lt;/code&gt;这个包。而且竟然支持管道操作，真真对这个包一见钟情。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;echarts4r&lt;/code&gt;包，echarts 4的R版本，能画很多交互的图
&lt;a href=&#34;https://echarts4r.john-coene.com/articles/advanced.html&#34;&gt;https://echarts4r.john-coene.com/articles/advanced.html&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;del&gt;&lt;code&gt;recharts&lt;/code&gt;包，echarts 2的R版本, 谢益辉开发。&lt;/del&gt;
&lt;del&gt;&lt;a href=&#34;http://madlogos.github.io/recharts/#-en&#34;&gt;http://madlogos.github.io/recharts/#-en&lt;/a&gt;&lt;/del&gt;
最近准备尝试用之前写过的recharts代码画一些图，才发现这个包可用了。原来谢大神早已弃坑，不再更新recharts.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;echarter&lt;/code&gt;包，echarts 4的R版本, 最新开发。作者在开发版本的网页中也介绍了之前几个版本的echarts的R接口,都是挂在GitHub上的&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;cosname/recharts - ECharts4&lt;/li&gt;
&lt;li&gt;JohnCoene/echarts4r - ECharts4&lt;/li&gt;
&lt;li&gt;yihui/recharts - ECharts2&lt;/li&gt;
&lt;li&gt;madlogos/recharts - ECharts2 forked from yihui/recharts&lt;/li&gt;
&lt;li&gt;madlogos/recharts2 - ECharts3&lt;/li&gt;
&lt;li&gt;ChanningWong/REcharts3 - ECharts3&lt;/li&gt;
&lt;li&gt;XD-DENG/ECharts2Shiny - ECharts3&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;数据科学&#34;&gt;数据科学&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;caret&lt;/code&gt;包的使用说明书，包含了很多数据科学的知识，值得深入研究&lt;/p&gt;
&lt;p&gt;链接：&lt;a href=&#34;https://topepo.github.io/caret/&#34;&gt;https://topepo.github.io/caret/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;关于模型评估的内容：&lt;a href=&#34;https://topepo.github.io/caret/measuring-performance.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Measuring Performance&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;示例：
&lt;a href=&#34;https://www.yinxiang.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;印象笔记官网&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;此外，还发现caret包能做&lt;a href=&#34;https://topepo.github.io/caret/recursive-feature-elimination.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Recursive Feature Elimination&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;统计学习即机器学习
&lt;a href=&#34;https://daviddalpiaz.github.io/r4sl/index.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;R for Statistical Learning&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;R可视化的网站。介绍了几个主流的R绘图包，并配有例子
&lt;a href=&#34;https://ecodatasci-tlv.github.io/visualizations_in_r/&#34;&gt;https://ecodatasci-tlv.github.io/visualizations_in_r/&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;相关性分析可视化，一个比一个漂亮的图
&lt;a href=&#34;https://jamesmarquezportfolio.com/correlation_matrices_in_r.html&#34;&gt;https://jamesmarquezportfolio.com/correlation_matrices_in_r.html&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Color variations between and within wheat plant</title>
      <link>/post/color-variations-between-and-within-wheat-plant/</link>
      <pubDate>Sun, 18 Oct 2020 00:00:00 +0000</pubDate>
      <guid>/post/color-variations-between-and-within-wheat-plant/</guid>
      <description>&lt;p&gt;&lt;img src=&#34;NC-variation_spatial-and-temperal.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;前几天，在微信公众号里看到有个R包（gganatogram) 可以画动物和植物的图形，但是里面的小麦不好看。于是把我用R画的小麦分享出来，比一比哪个更好看😜。&lt;/p&gt;
&lt;p&gt;话不多说，先上图。
&lt;img src=&#34;img1.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;先说说为什么要画这么一个图。&lt;/p&gt;
&lt;p&gt;那是在我刚进课题组的时候，就了解到实验室有大量小麦的数据。而且是从叶片到茎秆再到穗和籽粒等等各种器官一应俱全。更让人惊喜的是这些数据时间跨度大。当时我就在想，用什么样的方式才能展示出来这么丰富的空间和时间变化呢？&lt;/p&gt;
&lt;p&gt;一次偶然的机会，我联想到地图，地图里面的各个区域由多边形组成，区域的数值变化可以通过填色来完成。眼尖的同学应该看出来了，里面正是我华北平原的吴桥实验站（手动笑脸）。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;img2.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;而我们一株小麦上的各个器官正好对应着地图上不同区域。利用小麦不同器官的轮廓图，勾勒出多边形，再把多边形组合，就形成一株完整的小麦。&lt;/p&gt;
&lt;p&gt;有了这个想法之后，我就开始实施。首先从网上找到一株小麦的矢量图（就是各器官能分开的图形），然后根据各部分的轮廓创建多边形。是的，图形数据化用到了一款开源软件，名为&lt;a href=&#34;https://automeris.io/WebPlotDigitizer/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;WebPlotDigitizer&lt;/a&gt;。这款软件非常强大，可以提取图像或者图片中的坐标数据。这里特别提一句，小麦植株的比例做了一些微调，可能与真实的有点出入，但是不影响数据展示。还有一点，我们课题组专门研究地上部分的，暂时还没把根(器官)加进去，不过后期会考虑。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;img3.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;img4.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;多边形创建采用了专门处理gis数据的R包sf。&lt;/p&gt;
&lt;p&gt;最后的成品就是前面看到的这个样子了。每一个部分都可以根据自己的需求填上任意的颜色。而且颜色也可以根据需求自己选择，颜色的深浅代表指标的高低。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;img5.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/post/color-variations-between-and-within-wheat-plant/index_files/figure-html/unnamed-chunk-1-1.png&#34; width=&#34;672&#34; /&gt;
也可以给每个部分添加标签，放上对应的数据。这样看起来好是不是好很多。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/post/color-variations-between-and-within-wheat-plant/index_files/figure-html/unnamed-chunk-2-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;再来一张动图看看。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;mygif.gif&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;最后公布一下gganotom R包里面的小麦。看起来也还行 😄&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;wheatbygganotom.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Visualize my spectra</title>
      <link>/post/visualize-my-spectra/</link>
      <pubDate>Thu, 16 Jul 2020 00:00:00 +0000</pubDate>
      <guid>/post/visualize-my-spectra/</guid>
      <description>&lt;p&gt;从去年开始就一直在分析光谱的数据，刚开始以为R里面会有包能解决我关于光谱的所有问题。经过一段时间的试错之后，我发现自己错了。&lt;/p&gt;
&lt;p&gt;于是记录下来我自己实践的过程。&lt;/p&gt;
&lt;h3 id=&#34;批量读取光谱数据&#34;&gt;批量读取光谱数据&lt;/h3&gt;
&lt;p&gt;一般来说，拿到的原始光谱数据数据有这样的特点：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;光谱反射率和光谱吸收值夹杂在文件内部。&lt;/strong&gt; 以SR3501的数据为例，打开之后是这样的(如下图所示)。文件内部有很多关于仪器和配置的信息。真正对我们有价值的数据在27行以后。具体的就是此处的两列数据，第一列为波长，第二列为对应的反射率。所以这就要求读取数据的时候找到指定的行。
&lt;img src=&#34;sedfile_snapshot.jpg&#34; alt=&#34;SR3501sedfile&#34;&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;2.&lt;strong&gt;数据文件不止一个，常常需要批量读取。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;于是经过多次试错与总结，写下了下面的方法批量读取指定行的光谱数据。&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# get file names of all spectra
dir = &amp;quot;Spec/&amp;quot;
files = list.files(path = dir ,recursive = TRUE)
# read spectra from AB files
filepath = paste(dir, files, sep = &#39;&#39;)
# define a dataframe to store spectra data
spec.bdf &amp;lt;- data.frame()

for (flp in filepath) {
  spec &amp;lt;- read.table(flp, skip = 27, header = F ,
                     stringsAsFactors = F,row.names = 1)
  spec.t &amp;lt;- as.data.frame(t(spec))
  spec.bdf &amp;lt;- rbind(spec.bdf, spec.t)
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;根据需求，有时候要对数据做一下转置。转置后再把所有的数据bind到一起。&lt;/p&gt;
&lt;p&gt;采用&lt;code&gt;ggplot2&lt;/code&gt;绘图，需要的是长数据，原来两列的数据正好符合要求，只需要添加一列信息即可。&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# get file names of all spectra
dir = &amp;quot;Spec/&amp;quot;
files = list.files(path = dir ,recursive = TRUE)
# read spectra from AB files
filepath = paste(dir, files, sep = &#39;&#39;)
# define a dataframe to store spectra data
spec.bdf &amp;lt;- data.frame()

for (flp in filepath) {
  
  spec &amp;lt;- read.table(flp, skip = 27, header = F ,stringsAsFactors = F)
  colnames(spec) &amp;lt;- c(&amp;quot;Wavelengths&amp;quot;,&amp;quot;Reflectance&amp;quot;)
  spec$unique_id &amp;lt;- basename(flp)
  spec.df &amp;lt;- rbind(spec.df, spec)
  
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;有了数据就可以展示了，下面是选出来100条光谱进行的展示。&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;library(ggplot2)
library(cowplot)
load(file = &amp;quot;D:/blogdown/sourceRda/show spectra.rda&amp;quot;)
# Define nice breaks for x axis
brk  &amp;lt;- pretty(as.numeric(unique(spec$Wavelengths)), n = 10)
spec.df$grp &amp;lt;- &amp;quot;A&amp;quot;

ggplot(spec.df, aes(Wavelengths, Reflectance,group = unique_id)) +
  geom_line(aes(color = grp),alpha = 0.7, size = 0.6) +
  scale_x_continuous(breaks = brk) +
  theme_cowplot() +
  scale_color_manual(values = &amp;quot;black&amp;quot;) +
  theme(legend.position = &amp;quot;none&amp;quot;) # remove the legend
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/visualize-my-spectra/index_files/figure-html/unnamed-chunk-3-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;为了好看，我们还可以给每条光谱加上颜色&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/post/visualize-my-spectra/index_files/figure-html/unnamed-chunk-4-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;h3 id=&#34;后续更多有意思的分析且听下回分解&#34;&gt;后续更多有意思的分析，且听下回分解&lt;/h3&gt;
&lt;p&gt;先附上几张图，再留着以后慢慢讲&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;如何优雅的展示不同类别的光谱&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;spectra_organ_separate.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;光谱定量分析与主成分分析&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;Spectra_and_PCA.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;主成分分析用于分组分类&lt;/strong&gt;
&lt;img src=&#34;spectra_PCA.png&#34; alt=&#34;&#34;&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
  </channel>
</rss>
